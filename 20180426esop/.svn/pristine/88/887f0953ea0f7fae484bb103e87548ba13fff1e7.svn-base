/**
 * Created by wangxy on 2017/12/27.
 */
$(document).ready(function () {
    getContractModel();
    getNextStep();
    selOrderTrances();
    displayInformation();
    selOpporListByUnion();
    loadZfList();
});


//上传文件
function group_connect_choose() {
    var url = "uploadFileWindow";
    var ret = window.showModalDialog(url, window, 'dialogTop:0;dialogWidth=500px;DialogHeight=300px;help=0;center=1;status:yes;scroll=1');
    if (ret != undefined) {//ret为上传附件返回值列表 以"|"分开
        $("#attachment_id_list").val(ret);
    }
}

//加载合同信息、产品信息模块
function getContractModel() {
    //资费信息
    $.ajax({
        type: 'POST',
        url: 'toContractChargeInfo',
        data: {
            "contract_id": $("#contract_id").val(),
            "elecpack_id":$("#elecpack_id").val()
        },
        dataType: 'text',
        success: function (data) {
            $("#chargesInfo").html(data);
        },
        error: function (data) {
            alert("加载资费信息失败！");
        }
    });
    //合同信息
    $.ajax({
        type: 'POST',
        url: 'toContractDetailInfo',
        data: {
            "contract_id": $("#contract_id").val(),
            "elecpack_id":$("#elecpack_id").val()
        },
        dataType: 'text',
        success: function (data) {
            $("#tbody_contract").html(data);
        },
        error: function (data) {
            alert("加载合同信息模板失败！");
        }
    });

}


//加载折扣信息
function loadZfList() {
    var mulength = '${fn:length(contractChargesList)}';
    for(var i = 0;i<mulength;i++)
    {
        alert('${contractChargesList[i]}');

    }



    // var zklist = $("#zkList").val();
    // alert(zklist);
    // for(var i=0;i<zklist.length;i++){
    //     alert(zklist[i]);
    // }


}

function getNextStep() {
    var actionId = $("#actionId").val();
    $.ajax({
        type: 'POST',
        url: '/workflow/getFirstSteps',
        data: {
            "procTypeCode": $("#procTypeCode").val(),
            "branchCode": $("#branchCode").val(),
            "keyValue": $("#keyValue").val(),
            "loginCode": $("#loginCode").val(),
            "loginName": $("#loginName").val(),
            "actionId": $("#actionId option:selected").val(),
        },
        success: loadNexttStepsHandler
    });

}

function changePayment() {//如果选择后付，则还需要选择付费主体
    var elecpack_id = $("#elecpack_id").val();
    var payment = $("#payment option:selected").val();
    if(elecpack_id == 5 || elecpack_id == 6 || elecpack_id==7){//付费方式为预付，只能为电子发票
        if(payment == 1){
            $("#type_two").click();
            $(".zz_tax").css('display','none');
        }else{
            $(".zz_tax").show();
        }
        return;
    }

    if(payment == 2){
        $(".pay_main_body").show();
    }
    if(payment == 1){
        $(".pay_main_body").css("display","none");
    }
}

function selOrderTrances(){
    $.ajax({
        url: "orderflow/getTrance",
        type: "post",
        "data": {
            "procInstId":  $("#procInstId").val()
        },
        success: function (result) {
            $.each(result, function (i, field) {
                var dealOpinion = "";
                var dealRemarks = "";
                if(field.dealOpinion != null && field.dealOpinion != ""){
                    dealOpinion = field.dealOpinion;
                }
                if(field.dealRemarks != null && field.dealRemarks != ""){
                    dealRemarks = field.dealRemarks;
                }
                var trStr = "<tr class='tr-data-cc'><td>" + field.taskInstId +"</td><td>" +field.stepName+"</td><td>" + field.dealName +"</td><td>" + field.dealDateTime +"</td><td>" + dealOpinion
                    +"</td><td>"+dealRemarks +"</td></tr>";
                $("#trancesTb").append(trStr);
            })
        }
    });
}

function displayInformation(){
    var elecPack_id = $("#elecpack_id").val();
    // alert("模板ID"+elecPack_id);
    if (elecPack_id == 1){//集团工作流量包
        $(".open_time").show();
        $(".penalty").show();

    }
    if(elecPack_id == 2){//集团工作流量池（本地）
        $(".business_type").show();
        $(".open_time").show();
        $(".penalty").show();
    }
    if (elecPack_id == 3){//手机流量集团购
        $("#type_two").click();
        $("#type_one").hide();
        $("#span_info_id").hide();
        $(".used_in").show();

    }
    if(elecPack_id == 4){//集团分区流量包
        $(".payment").show();
        $(".open_time").show();
        $(".use_area").show();
        if ($("#payment").val() == 2) {//初始化付费主体
            $(".pay_main_body").show();
        }
    }
}

function loadNexttStepsHandler(data) {
    //   alert(JSON.stringify(data));
    //   var returnCode = data.returnCode;
    var stepList = data.stepList[0];
    $("#next_deal5").val(stepList.ctProcStepRel.stepName);
    //  alert(stepList.ctProcStepRel.stepName);
    // $('#next_stepName').text(stepList.ctProcStepRel.stepName);
    $(".ASSIGNEE").html("");
    for (var i = 0; i < stepList.assignees.length; i++) {     //循环添加多个值
        $(".ASSIGNEE").append("<option value='"+stepList.assignees[i].assignee+"'>" + stepList.assignees[i].assigneeName + "</option>");
    }
    var changeId="ASSIGNEE_"+stepList.ctProcStepRel.stepId;
    $(".ASSIGNEE").attr("id",changeId);
}


$(".btn-logins").click(function() {
    dialog({
        title: "资费",
        content: document.getElementById('login-boxs'),
        width: 800,
        height: 500,
        padding: 0
    }).showModal()
});
$("#btn-login-submits").click(function(event) {
    dialog.getCurrent().close().remove();
});
$("#actionId").change(function () {
    getNextStep();
});

//资费弹窗
function showChargesInfo(){
    dialog({
        title: "资费",
        content: document.getElementById('login-boxs'),
        width: 800,
        height: 500,
        padding: 0
    }).showModal()
}

//添加资费
function  addCharge(btn) {
    var elecpack_id = $("#elecpack_id").val();
    var index = layer.load(2, {
        shade: [0.1,'#fff'] //0.1透明度的白色背景
    });
    var charge_id = $(btn).parent().parent("tr").attr("chargeId");
    var price = $(btn).parent().parent().children(".price").html();
    var content = $(btn).parent().parent().children(".content").html();
    var number = $(btn).parent().parent().children(".numbers").html();
    var remark = $(btn).parent().parent().children(".remark").html();
    var thisBody = $(btn);

    $("#chargeList").append('<tr chargeId = "'+charge_id+'"> ' +
        '<td class="price">'+price+'</td> <td class="content">'+content+'</td> <td class="numbers">'+'<input type="number" class="input-sty04 form-ipt" onblur="changeNum(this)"  value="1"/>'+'</td><td class="remark">'+remark+'</td> <td><input type="button" class="deleteCharge" onclick="deleteCharge(this);" value="删除"/></td> </tr>');
    thisBody.parent().parent().remove();
    sumMoney();
    if(elecpack_id==5||elecpack_id==6 || elecpack_id==7){
        sumNumber();
        sumDaiKuan();
    }
    layer.close(index);
}

//删除资费
function deleteCharge(btn) {
    var elecpack_id = $("#elecpack_id").val();
    var charge_id = $(btn).parent().parent("tr").attr("chargeid");
    var price = $(btn).parent().parent().children(".price").html();
    var content = $(btn).parent().parent().children(".content").html();
    var number = $(btn).parent().parent().children(".numbers").find("input").val();
    var remark = $(btn).parent().parent().children(".remark").html();
    $("#price_tbody").append('<tr class="charge_id" chargeId="'+charge_id+'" >'+
        '<td class="price">'+price+'</td>'+
        '<td class="content">'+content+'</td>' +
        '<td class="numbers">1</td>' +
        '<td class="remark">'+remark+'</td>' +
        '<td><input type="button" class="" onclick="addCharge(this);" value="添加"/></td>'+
        '</tr>'
    );
    $(btn).parent().parent().remove();
    sumMoney();
    if(elecpack_id==5||elecpack_id==6 || elecpack_id==7){
        sumNumber();
        sumDaiKuan();
    }
}

function changeNum(ob) {
    var elecpack_id = $("#elecpack_id").val();
    if(ob.value<1){
        alert("资费数量至少为1！");
        ob.value = 1;
        ob.focus();
        return;
    }
    if(elecpack_id==5||elecpack_id==6 || elecpack_id==7){
        sumNumber();
        sumDaiKuan();
    }
    sumMoney();
}

//计算合同条数
function sumNumber() {
    var trList = $("#chargeList").children("tr");
    var size = trList.length;
    var total = 0;
    for(var i = 0 ;i<size; i++){
        var tdArr = trList.eq(i).find("td");
        var num = parseInt(tdArr.eq(2).find("input").val()); //数量
        if(num < 1){
            alert("资费数量至少为1！");
            tdArr.eq(2).find("input").val(1);
            return;
        }
        total = total+num;
    }
    $("#dedicated_amount").val(total);
}
//计算带宽
function sumDaiKuan() {
    var trList = $("#chargeList").children("tr");
    var size = trList.length;
    var total = "";
    for(var i = 0 ;i<size; i++){
        var tdArr = trList.eq(i).find("td");
        var bandwidth = parseInt(tdArr.eq(1).text()) + 'M'; //带宽
        if(total == null || total == ""){
            total = bandwidth;
        }else{
            total = total + ',' + bandwidth;
        }
    }
    $("#bandwidth").val(total);
}


//计算合同总金额
function sumMoney(){
    var trList = $("#chargeList").children("tr");
    var size = trList.length;
    var total = 0;
    var discountVal = $("#contract_discount").val();//折扣
    for(var i = 0 ;i<size; i++){
        var tdArr = trList.eq(i).find("td");
        var priceVal = parseInt(tdArr.eq(0).text()); //金额
        var num = parseInt(tdArr.eq(2).find("input").val()); //数量
        if(discountVal!=null&&discountVal!=""){
            var discountRate = parseInt(discountVal)/100;
            total = priceVal * num * discountRate + total;
        }else{
            total = priceVal * num + total;
        }
    }
    $("#total_amount").val(total);
}

function queryOpportunityNo() {
    $("#opportunity_no").val("");
    dialog({
        title: "查询商机号",
        content: document.getElementById('oppor_window'),
        width: 800,
        height: 500,
        padding: 0
    }).showModal()
}

function selOpporListByUnion(jtCode,jtName) {
    var jtCode = $("#first_party_code").val();
    var jtName = $("#first_party").val();
    table =  $('#oppor_list').DataTable( {
        dom: "Bfrtip",
        bLengthChange:true,
        "bPaginate": true,
        "bFilter": false,
        //"iDisplayLength": 10,
        //"aLengthMenu": [10, 50, 100 ],
        destroy:true,
        "pageLength": 5,//设置每页显示多少条记录
        "language": {
            "url": "/esop/static/data/Chinese.json"
        }, //多语言配置
        processing: true,
        serverSide: true,
        ajax: {
            url:"selOpporNo",
            type:"get",
            dataType:"json",
            data:{
                unionCode : jtCode,
                unionName: jtName,
            },
        },
        columns: [
            { data: "unionName"},
            { data: "unionCode"},
            { data: "opporNo"},
            { data: "linkMan"},
            { data:"null",
                "bSortable": false,
                "render":function (data, type,row){
                    var opporNo = row.opporNo;
                    var html = "<input type='button' onclick='addOppor(\""+opporNo+"\")' value='选中'></input>";
                    return html;
                }
            }

        ],
        select: true,
        buttons: [
        ]
    } );
}

function addOppor(opporNo) {
    if(opporNo==null||$.trim(opporNo)=='null'||$.trim(opporNo)==''){
        alert("商机号为空，无法选择！");
        return;
    }
    var index = layer.load(2, {
        shade: [0.1,'#fff'] //0.1透明度的白色背景
    });
    /*
    var temp = $("#opportunity_no").val();
    var tempList = temp.split(",");
    if(tempList.length>0){
        for(var i=0;i<tempList.length;i++){
            if(tempList[i] == opporNo){
                alert("该商机号已选择！");
                return;
            }
        }
    }
    if(temp==null||$.trim(temp)==''){
        $("#opportunity_no").val(opporNo);
    }else{
        $("#opportunity_no").val(temp+","+opporNo);
    }*/
    $("#opportunity_no").val(opporNo);
    var elecpack_id = $("#elecpack_id").val();
    //根据商机号查询合同信息相关字段
    $.ajax({
        url:"getContractCloumByOpporNo",
        type:"post",
        data:{opporNo:opporNo},
        cache: false,
        success:function(data){
            if(data.code == 0){
                if(elecpack_id == 5){
                    $("#first_access_address").val(data.reData.first_access_address);
                    $("#interface_in").val(data.reData.interface_in);
                    $("#interface_type").val(data.reData.interface_type);
                }else if(elecpack_id == 6 || elecpack_id == 7){
                    $("#a_access_address").val(data.reData.a_access_address);
                    $("#a_interface_type").val(data.reData.a_interface_type);
                    $("#z_access_address").val(data.reData.z_access_address);
                    $("#z_interface_type").val(data.reData.z_interface_type);
                    $("#first_connection_interface").val(data.reData.first_connection_interface);
                    $("#second_connection_interface").val(data.reData.second_connection_interface);
                }
                //关闭弹窗
                dialog.getCurrent().close().remove();
            }else if(data.reStatus == 1){
                alert("没有对应数据！");
            }else if(data.reStatus == 2){
                alert("请求失败！");
            }
            layer.close(index);
        },
        error:function () {
            layer.close(index);
            alert("请求失败！！");
        }
    });
}


//切换发票类型
function changeInType(type) {

    $("#temp_id").val(type);
    if(type == 0){//切换为增值税发票
        $("#second_invoice_name").removeAttr("disabled");
        $("#second_taxpayer_code").removeAttr("disabled");
        $("#second_invoice_username").removeAttr("disabled");
        $("#second_invoice_address").removeAttr("disabled");
        $("#second_invoice_phone").removeAttr("disabled");
        $("#second_party_username").removeAttr("disabled");


        $("#second_invoice_name").val("");
        $("#second_taxpayer_code").val("");
        $("#second_invoice_username").val("");
        $("#second_invoice_address").val("");
        $("#second_invoice_phone").val("");
        $("#second_party_username").val("");

        // $("#span_info_id").attr("class","ui-btn");
        // $("#span_info_id").addClass("fs-14");
        // $("#change_invoice_type").removeClass();

        // $("#type_two").attr("checked",true);
        // $("#type_one").attr("checked",false);
    }
    if(type == 1){//切换为电子发票

        $("#second_invoice_name").attr("disabled",true);
        $("#second_taxpayer_code").attr("disabled",true);
        $("#second_invoice_username").attr("disabled",true);
        $("#second_invoice_address").attr("disabled",true);
        $("#second_invoice_phone").attr("disabled",true);
        $("#second_party_username").attr("disabled",true);

        $("#second_invoice_name").val($("#temp_name").val());
        $("#second_taxpayer_code").val($("#temp_code").val());
        $("#second_invoice_username").val($("#temp_user_name").val());
        $("#second_invoice_address").val($("#temp_add").val());
        $("#second_invoice_phone").val($("#temp_phone").val());
        $("#second_party_username").val($("#temp_user_name").val());

        // $("#change_invoice_type").attr("class","ui-btn")
        // $("#change_invoice_type").addClass("fs-14")
        // $("#span_info_id").removeClass();

        // $("#type_one").attr("checked",true);
        // $("#type_two").attr("checked",false);
    }
}

    //获取chargesId
function saveChargeList() {

    var trList = $("#chargeList").children("tr");
    var size = trList.length;
    var charge_id_list = "";
    for(var i = 0 ;i<size; i++){
        var tdArr = trList.eq(i).find("td");
        var number = tdArr.eq(2).find('input').val();//数量
        var chargeId = trList.eq(i).attr("chargeId");

        if(charge_id_list==""){
            charge_id_list = chargeId+"|"+number;
        }else{
            charge_id_list = charge_id_list+","+chargeId+"|"+number;
        }
    }
    return charge_id_list;
}
//重新提交
$("#submit").click(function () {
    //验证空值
    if(!validateEmpty()){
        return;
    };

    /* //退回要改变订单的字段
     if ($("#idea5 ").val() == "0") {
     alert("退回！！")
     updateOrderState();
     }
     //受理时，要改变的字段
     if ($("#idea5 ").val() == "1" && $("#stepId").val() == "1") {
     updateInstState2();
     }*/

    var t = {};
    var actionId = $("#actionId option:selected").val();
    key = "procInstId";
    value = $("#procInstId").val();
    t[key] = value;

    key1 = "taskInstId";
    value1 = $("#taskInstId").val();
    t[key1] = value1;

    key2 = "taskId";
    value2 = $("#taskId").val();
    t[key2] = value2;

    key3 = "stepId";
    value3 = $("#stepId").val();
    t[key3] = value3;

    key4 = "procId";
    value4 = $("#procId").val();
    t[key4] = value4;

    key5 = "dealOpinion";
    value5 = "重亲提交";
    t[key5] = value5;

    key6 = "remarks";
    value6 = "修改";
    t[key6] = value6;

    var name_1 = "ASSIGNEE_1";
    var name_2 = "ASSIGNEE_2";
    var ASSIGNEE_1 = $("#actionId").val();
    var num = $("#ASSIGNEE").val();
    if(ASSIGNEE_1 == 2){
        t[name_1] = num;
    }
    if(ASSIGNEE_1 == 3){
        t[name_2] = num;
    }

    var invoice_type;
    var radio = document.getElementsByName("radio");
    for (i=0; i<radio.length; i++) {
        if (radio[i].checked) {
            invoice_type = radio[i].value;
        }
    }

    var charge_id_list = saveChargeList();
    t["chargeIds"] = charge_id_list;
    t["product_id"] = $("#prod_id").val();
    t["product_name"] = $("#prod_name").val();
    t["contract_name"] =  $("#contract_name").val();
    t["contract_desc"] = $("#contract_desc").val();
    t["first_party_code"] = $("#first_party_code").val();
    t["first_party"] = $("#first_party").val();
    t["first_party_charge"] = $("#first_party_charge").val();
    t["first_party_address"] = $("#first_party_address").val();
    t["first_party_post_code"] = $("#first_party_post_code").val();
    t["first_party_phone"] = $("#first_party_phone").val();
    /*t["second_party"] = $("#second_party").val();
     t["second_party_code"] = $("#second_party_code").val();
     t["second_party_charge"] = $("#second_party_charge").val();
     t["second_party_address"] = $("#second_party_address").val();
     t["second_party_post_code"] = $("#second_party_post_code").val();
     t["second_party_phone"] = $("#second_party_phone").val();
     t["discount"] = $("#discount").val();*/
    t["total_amount"] = $("#total_amount").val();
    t["bond"] = $("#bond").val();
    t["first_invoice_name"] = $("#first_invoice_name").val();
    t["first_taxpayer_code"] = $("#first_taxpayer_code").val();
    t["first_invoice_band"] = $("#first_invoice_band").val();
    t["first_invoice_username"] = $("#first_invoice_username").val();
    t["first_invoice_number"] = $("#first_invoice_number").val();
    t["first_invoice_address"] = $("#first_invoice_address").val();
    t["first_invoice_phone"] = $("#first_invoice_phone").val();
    t["second_invoice_name"] = $("#second_invoice_name").val();
    t["second_taxpayer_code"] = $("#second_taxpayer_code").val();
    t["second_invoice_band"] = $("#second_invoice_band").val();
    t["second_invoice_username"] = $("#second_invoice_username").val();
    t["second_invoice_number"] = $("#second_invoice_number").val();
    t["first_party_username"] = $("#first_party_username").val();
    t["first_party_band"] = $("#first_party_band").val();
    t["first_party_account_number"] = $("#first_party_account_number").val();
    t["second_party_username"] = $("#second_party_username").val();
    t["second_party_band"] = $("#second_party_band").val();
    t["second_party_account_number"] = $("#second_party_account_number").val();
    t["second_invoice_address"] = $("#second_invoice_address").val();
    t["second_invoice_phone"] = $("#second_invoice_phone").val();
    t["first_contacts_name"] = $("#first_contacts_name").val();
    t["first_contacts_id_card"] = $("#first_contacts_id_card").val();
    t["first_contacts_phone"] = $("#first_contacts_phone").val();
    t["first_contacts_email"] = $("#first_contacts_email").val();
    t["first_contacts_address"] = $("#first_contacts_address").val();
    t["pay_cycle"] = $("#pay_cycle").val();
    t["contract_id"] = $("#contract_id").val();
    t["elecpack_id"] = $("#elecpack_id").val();
    t["elecpack_name"] = $("#elecpack_name").val();
    t["used_in"] = $("#buy_for_what").val();
    t["safe_client"] = $("#jf_fddbr").val();
    t["safe_address"] = $("#jf_address").val();
    t["safe_contacts"] = $("#jf_linkMan").val();
    t["safe_phone"] = $("#jf_phone").val();
    t["second_party"] = $("#yf_first_party").val();
    t["second_party_charge"] =$("#yf_first_party_charge").val();
    t["second_party_address"] = $("#yf_first_party_address").val();
    t["second_party_post_code"] = $("#yf_first_party_post_code").val();
    t["second_party_phone"] = $("#yf_first_party_phone").val();
    t["invoice_type"] = invoice_type;//发票类型
    t["oppor_id"] = $("#opportunity_no").val();//商机号
    var elec_pack_id = $("#elecpack_id").val();
    t["payment"] = $("#payment").val();
    if (elec_pack_id==1 || elec_pack_id==2){
        t["payment"] = "2";//后付
    }
    if(elec_pack_id == 3){
        t["payment"] = "1";//手机流量集团购只能预付
    }

    t["pay_main_body"] = $("#pay_main_body").val();//付费主体
    t["open_time"] = $("#open_time").val();//流量业务开通时间
    t["use_area"] = $("#use_area").val();//流量使用区域
    t["business_type"] = $("#business_type").val();//甲方业务类型及资费模式
    t["penalty"] = $("#penalty").val();//违约金

    //专线合同
    t["dedicated_amount"] = $("#dedicated_amount").val();
    t["bandwidth"] = $("#bandwidth").val();
    t["lease_term"] = $("#lease_term").val();
    t["interface_type"] = $("#interface_type").val();
    t["first_access_address"] = $("#first_access_address").val();
    t["interface_in"] = $("#interface_in").val();
    t["a_access_address"] = $("#a_access_address").val();
    t["a_interface_type"] = $("#a_interface_type").val();
    t["z_access_address"] = $("#z_access_address").val();
    t["z_interface_type"] = $("#z_interface_type").val();
    t["first_connection_interface"] = $("#first_connection_interface").val();
    t["second_connection_interface"] = $("#second_connection_interface").val();

    t["oper_no"] = $("#login_no").val();//修改人工号
    t["oper_name"] = $("#login_name").val();//修改人姓名

    t["attachment_id_list"] = $("#attachment_id_list").val();//附件上传返回ID

    $("#submit").val('提交中..')
    $("#submit").attr("disabled",true);
    $.ajax({
        url: "/packReject",
        type: "post",
        "data": t,
        success: function (data) {

            alert(data.message);
            if(data.code == '1'){
                window.close();
            }else{
                $("#submit").val('提交')
                $("#submit").removeAttr("disabled");
            }

        },
        error:function(data){
            $("#submit").val('提交')
            $("#submit").removeAttr("disabled");
            alert("发起失败");
        }
    });

});

function validateEmpty() {
    //集团客户信息（甲方）
    var unionCode = $("#first_party_code").val();
    var unionName = $("#first_party").val();
    var fdPerson = $("#first_party_charge").val();
    var firstAddress = $("#first_party_address").val();
    // var postCode = $("#first_party_post_code").val();//邮编不是必填项目
    var firstPhone = $("#first_party_phone").val();
    if (unionCode == null || $.trim(unionCode) == '') {
        alert('集团编码不能为空！');
        $("#first_party_code").focus();
        return false;
    }
    if (unionName == null || $.trim(unionName) == '') {
        alert('集团名称不能为空！');
        $("#first_party").focus();
        return false;
    }
    if (fdPerson == null || $.trim(fdPerson) == '') {
        alert('法定代表人/负责人不能为空！');
        $("#first_party_charge").focus();
        return false;
    }
    if (firstAddress == null || $.trim(firstAddress) == '') {
        alert('地址不能为空！');
        $("#first_party_address").focus();
        return false;
    }
    if (firstPhone == null || $.trim(firstPhone) == '') {
        alert('电话不能为空！');
        $("#first_party_phone").focus();
        return false;
    }
    if (!judgeMobile(firstPhone)) {
        alert('请输入正确的电话！');
        $("#first_party_phone").focus();
        return false;
    }
    //集团信息（乙方）
    var yf_unionCode = $("#yf_first_party_code").val();
    var yf_unionName = $("#yf_first_party").val();
    var yf_fdPerson = $("#yf_first_party_charge").val();
    var yf_firstAddress = $("#yf_first_party_address").val();
    var yf_firstPhone = $("#yf_first_party_phone").val();
    // if(yf_unionCode==null||$.trim(yf_unionCode)==''){
    //     alert('集团编码不能为空！');
    //     $("#yf_first_party_code").focus();
    //     return false;
    // }
    if (yf_unionName == null || $.trim(yf_unionName) == '') {
        alert('集团名称不能为空！');
        $("#yf_first_party").focus();
        return false;
    }
    if (yf_fdPerson == null || $.trim(yf_fdPerson) == '') {
        alert('法定代表人/负责人不能为空！');
        $("#yf_first_party_charge").focus();
        return false;
    }
    if (yf_firstAddress == null || $.trim(yf_firstAddress) == '') {
        alert('地址不能为空！');
        $("#yf_first_party_address").focus();
        return false;
    }
    if (yf_firstPhone == null || $.trim(yf_firstPhone) == '') {
        alert('电话不能为空！');
        $("#yf_first_party_phone").focus();
        return false;
    }
    if (!judgeMobile(yf_firstPhone)) {
        alert('请输入正确的电话！');
        $("#yf_first_party_phone").focus();
        return false;
    }
    //合同信息
    var elecpack_id = $("#elecpack_id").val();
    var conName = $("#contract_name").val();//合同名称
    if (conName == null || $.trim(conName) == '') {
        alert('合同标题不能为空！');
        $("#contract_name").focus();
        return false;
    }
    var tolAmount = $("#total_amount").val();//总金额
    if (tolAmount == null || $.trim(tolAmount) == '') {
        alert('合同总金额不能为空！');
        $("#total_amount").focus();
        return false;
    }
    var opportunity_no = $("#opportunity_no").val();//商机号
    if(opportunity_no == null || $.trim(opportunity_no) == ''){
        alert('请选择商机号！');
        $("#opportunity_no").focus();
        return false;
    }
    var contract_discount = $("#contract_discount").val();//折扣
    if (elecpack_id == 1 || elecpack_id == 2 || elecpack_id == 3) {
        if(contract_discount == null || $.trim(contract_discount) == ''){
            alert('请选择折扣！');
            $("#contract_discount").focus();
            return false;
        }
    }
    var bond = $("#bond").val();//保证金
    if(elecpack_id == 1 || elecpack_id == 2 || elecpack_id == 3 || elecpack_id == 4){
        if(bond == null || $.trim(bond) == ''){
            alert('请填写保证金！');
            $("#bond").focus();
            return false;
        }
    }
    var penalty = $("#penalty").val();//违约金
    if(elecpack_id == 1 || elecpack_id == 2){
        if(penalty == null || $.trim(penalty) == ''){
            alert('请填写违约金！');
            $("#penalty").focus();
            return false;
        }
    }
    var payCyc = $("#pay_cycle").val();//缴费周期
    if(payCyc == 0){
        alert('请选择缴费周期！');
        $("#pay_cycle").focus();
        return false;
    }
    var open_time = $("#open_time").val();//开通时间
    if (elecpack_id == 1 || elecpack_id == 2 || elecpack_id == 4) {
        if(open_time == null || $.trim(open_time) == ''){
            alert('请选择开通时间！');
            $("#open_time").focus();
            return false;
        }else {
            var time_1 = toDate(open_time);
            var now_1 = new Date();
            if(time_1 < now_1){
                alert("开通时间应晚于当前时间");
                $("#open_time").focus();
                return false;
            }
        }
    }

    var buyFWhat = $("#buy_for_what").val();//用于
    if(elecpack_id == 3 || elecpack_id == 5){
        if (buyFWhat == null || $.trim(buyFWhat) == '') {
            alert('请填写购买产品用于！');
            $("#buy_for_what").focus();
            return false;
        }
    }
    var business_type = $("#business_type").val();
    if(elecpack_id == 3){
        if (business_type == null || $.trim(business_type) == '') {
            alert('请填写甲方业务类型及资费模式！');
            $("#business_type").focus();
            return false;
        }
    }
    var payment = $("#payment").val();
    if(elecpack_id == 4 || elecpack_id == 5||elecpack_id == 6 || elecpack_id==7){
        if (payment == 0) {
            alert('请选择付费方式！');
            $("#payment").focus();
            return false;
        }
    }
    var pay_main_body = $("#pay_main_body").val();
    if(elecpack_id == 4){
        if(payment == 2){
            if (pay_main_body == null || $.trim(pay_main_body) == '') {
                alert('请选择付费主体！');
                $("#pay_main_body").focus();
                return false;
            }
        }
    }
    var use_area = $("#use_area").val();
    if(elecpack_id == 4){
        if (use_area == null || $.trim(use_area) == '') {
            alert('请填写区域！');
            $("#use_area").focus();
            return false;
        }
    }
    var dedicated_amount = $("#dedicated_amount").val();
    if(elecpack_id == 5 || elecpack_id ==6 || elecpack_id==7){
        if (dedicated_amount == null || $.trim(dedicated_amount) == '') {
            alert('请填写条数！');
            $("#dedicated_amount").focus();
            return false;
        }
    }
    var bandwidth = $("#bandwidth").val();
    if(elecpack_id == 5 || elecpack_id ==6 || elecpack_id==7){
        if (bandwidth == null || $.trim(bandwidth) == '') {
            alert('请填写带宽！');
            $("#bandwidth").focus();
            return false;
        }
    }
    var lease_term = $("#lease_term").val();
    if(elecpack_id == 5 || elecpack_id ==6 || elecpack_id==7){
        if (lease_term == '0') {
            alert('请选择租用期限！');
            $("#lease_term").focus();
            return false;
        }
    }
    var interface_type = $("#interface_type").val();
    if(elecpack_id == 5 ){
        if (interface_type == null || $.trim(interface_type) == '') {
            alert('请选择接口类型！');
            $("#interface_type").focus();
            return false;
        }
    }
    var first_access_address = $("#first_access_address").val();
    if(elecpack_id == 5 ){
        if (first_access_address == null || $.trim(first_access_address) == '') {
            alert('请选择甲方接入点地址！');
            $("#first_access_address").focus();
            return false;
        }
    }
    var interface_in = $("#interface_in").val();
    if(elecpack_id == 5 ){
        if (interface_in == null || $.trim(interface_in) == '') {
            alert('请选择 接口界面！');
            $("#interface_in").focus();
            return false;
        }
    }

    var a_access_address = $("#a_access_address").val();
    if(elecpack_id == 6 || elecpack_id==7){
        if (a_access_address == null || $.trim(a_access_address) == '') {
            alert('请选择A端接入地址！');
            $("#a_access_address").focus();
            return false;
        }
    }
    var a_interface_type = $("#a_interface_type").val();
    if(elecpack_id == 6 || elecpack_id==7){
        if (a_interface_type == null || $.trim(a_interface_type) == '') {
            alert('请选择A端接口类型！');
            $("#a_interface_type").focus();
            return false;
        }
    }
    var z_access_address = $("#z_access_address").val();
    if(elecpack_id == 6 || elecpack_id==7){
        if (z_access_address == null || $.trim(z_access_address) == '') {
            alert('请选择 Z端接入地址！');
            $("#z_access_address").focus();
            return false;
        }
    }
    var z_interface_type = $("#z_interface_type").val();
    if(elecpack_id == 6 || elecpack_id==7){
        if (z_interface_type == null || $.trim(z_interface_type) == '') {
            alert('请选择 Z端接口类型！');
            $("#z_interface_type").focus();
            return false;
        }
    }
    var first_connection_interface = $("#first_connection_interface").val();
    if(elecpack_id == 6 ){
        if (first_connection_interface == null || $.trim(first_connection_interface) == '') {
            alert('请选择甲方连接接口！');
            $("#first_connection_interface").focus();
            return false;
        }
    }
    var second_connection_interface = $("#second_connection_interface").val();
    if(elecpack_id == 6 || elecpack_id==7){
        if (second_connection_interface == null || $.trim(second_connection_interface) == '') {
            alert('请选择乙方连接接口！');
            $("#second_connection_interface").focus();
            return false;
        }
    }
    var conDesc = $("#contract_desc").val();
    if (conDesc == null || $.trim(conDesc) == '') {
        alert('合同描述不能为空！');
        $("#contract_desc").focus();
        return false;
    }
    if (conDesc.length > 200) {
        alert('合同描述字数超过200！！！');
        $("#contract_desc").focus();
        return false;
    }
    //双方发票信息
    var jfName = $("#first_invoice_name").val();
    var yfName = $("#second_invoice_name").val();
    if (jfName == null || $.trim(jfName) == '') {
        alert('甲方名称为空！');
        $("#first_invoice_name").focus();
        return false;
    }
    if (yfName == null || $.trim(yfName) == '') {
        alert('乙方名称为空！');
        $("#second_invoice_name").focus();
        return false;
    }
    var jnsCode = $("#first_taxpayer_code").val();
    var ynsCode = $("#second_taxpayer_code").val();
    if (jnsCode == null || $.trim(jnsCode) == '') {
        alert('国税纳税人识别号不能为空！');
        $("#first_taxpayer_code").focus();
        return false;
    }
    if (ynsCode == null || $.trim(ynsCode) == '') {
        alert('国税纳税人识别号不能为空！');
        $("#second_taxpayer_code").focus();
        return false;
    }
    if (!judgeTaxpayerCode(jnsCode)) {
        alert('国税纳税人识别号为数字或字母组合！');
        $("#first_taxpayer_code").focus();
        return false;
    }
    if (!judgeTaxpayerCode(ynsCode)) {
        alert('国税纳税人识别号为数字或字母组合！');
        $("#second_taxpayer_code").focus();
        return false;
    }
    var jyBank = $("#first_invoice_band").val();
    var yfBank = $("#second_invoice_band").val();
    if (jyBank == null || $.trim(jyBank) == '') {
        alert('开户行不能为空！');
        $("#first_invoice_band").focus();
        return false;
    }
    if (yfBank == null || $.trim(yfBank) == '') {
        alert('开户行不能为空！');
        $("#second_invoice_band").focus();
        return false;
    }
    var jfUserName = $("#first_invoice_username").val();
    var yfUserName = $("#second_invoice_username").val();
    if (jfUserName == null || $.trim(jfUserName) == '') {
        alert('户名不能为空！');
        $("#first_invoice_username").focus();
        return false;
    }
    if (yfUserName == null || $.trim(yfUserName) == '') {
        alert('户名不能为空！');
        $("#second_invoice_username").focus();
        return false;
    }
    var jfBankNo = $("#first_invoice_number").val();
    var yfBankNo = $("#second_invoice_number").val();
    if (jfBankNo == null || $.trim(jfBankNo) == '') {
        alert('账号不能为空！');
        $("#first_invoice_number").focus();
        return false;
    }
    if (!judgeNum(jfBankNo)) {
        alert('账号必须为数字！');
        $("#first_invoice_number").focus();
        return false;
    }
    if (yfBankNo == null || $.trim(yfBankNo) == '') {
        alert('账号不能为空！');
        $("#second_invoice_number").focus();
        return false;
    }
    if (!judgeNum(yfBankNo)) {
        alert('账号必须为数字！');
        $("#second_invoice_number").focus();
        return false;
    }
    var jfAdd = $("#first_invoice_address").val();
    var yfAdd = $("#second_invoice_address").val();
    if (jfAdd == null || $.trim(jfAdd) == '') {
        alert('地址不能为空！');
        $("#first_invoice_address").focus();
        return false;
    }
    if (yfAdd == null || $.trim(yfAdd) == '') {
        alert('地址不能为空！');
        $("#second_invoice_address").focus();
        return false;
    }
    var jfPhone = $("#first_invoice_phone").val();
    var yfPhone = $("#second_invoice_phone").val();
    if (jfPhone == null || $.trim(jfPhone) == '') {
        alert('联系方式不能为空！');
        $("#first_invoice_phone").focus();
        return false;
    }
    if(!judgeMobile(jfPhone)){
        alert('联系方式格式不正确！');
        $("#first_invoice_phone").focus();
        return false;
    }
    if (yfPhone == null || $.trim(yfPhone) == '') {
        alert('联系方式不能为空！');
        $("#second_invoice_phone").focus();
        return false;
    }
    if(!judgeMobile(yfPhone)){
        alert('联系方式格式不正确！');
        $("#second_invoice_phone").focus();
        return false;
    }
    //银行账户信息
    var jfPartyName = $("#first_party_username").val();
    var yfPartyName = $("#second_party_username").val();
    if (jfPartyName == null || $.trim(jfPartyName) == '') {
        alert('户名不能为空！');
        $("#first_party_username").focus();
        return false;
    }
    if (yfPartyName == null || $.trim(yfPartyName) == '') {
        alert('户名不能为空！');
        $("#second_party_username").focus();
        return false;
    }
    var fpBank = $("#first_party_band").val();
    var spBank = $("#second_party_band").val();
    if (fpBank == null || $.trim(fpBank) == '') {
        alert('开户行不能为空！');
        $("#first_party_band").focus();
        return false;
    }
    if (spBank == null || $.trim(spBank) == '') {
        alert('开户行不能为空！');
        $("#second_party_band").focus();
        return false;
    }
    var fpaNumber = $("#first_party_account_number").val();
    var spaNumber = $("#second_party_account_number").val();
    if (fpaNumber == null || $.trim(fpaNumber) == '') {
        alert('账号不能为空！');
        $("#first_party_account_number").focus();
        return false;
    }
    if (!judgeNum(fpaNumber)) {
        alert('账号必须为数字！');
        $("#first_party_account_number").focus();
        return false;
    }
    if (spaNumber == null || $.trim(spaNumber) == '') {
        alert('账号不能为空！');
        $("#second_party_account_number").focus();
        return false;
    }
    if (!judgeNum(spaNumber)) {
        alert('账号必须为数字！');
        $("#second_party_account_number").focus();
        return false;
    }
    //甲方集团缴费联系人信息
    var fcName = $("#first_contacts_name").val();
    var fcCard = $("#first_contacts_id_card").val();
    if (fcCard == null || $.trim(fcCard) == '') {
        alert('联系人身份证不能为空！');
        $("#first_contacts_id_card").focus();
        return false;
    }
    if (!judgeIdCard(fcCard)) {
        alert('请输入正确的身份证号码！');
        $("#first_contacts_id_card").focus();
        return false;
    }
    var fcPhone = $("#first_contacts_phone").val();
    var fcEmail = $("#first_contacts_email").val();
    var fcAdd = $("#first_contacts_address").val();
    if (fcName == null || $.trim(fcName) == '') {
        alert('联系人姓名不能为空！');
        $("#first_contacts_name").focus();
        return false;
    }
    if (fcPhone == null || $.trim(fcPhone) == '') {
        alert('联系人电话不能为空！');
        $("#first_contacts_phone").focus();
        return false;
    }
    if (!judgeMobile(fcPhone)) {
        alert('请输入正确的电话！');
        $("#first_contacts_phone").focus();
        return false;
    }
    if (fcEmail == null || $.trim(fcEmail) == '') {
        alert('联系人邮箱不能为空！');
        $("#first_contacts_email").focus();
        return false;
    }
    if (fcAdd == null || $.trim(fcAdd) == '') {
        alert('联系人地址不能为空！');
        $("#first_contacts_address").focus();
        return false;
    }
    return true;
}

// 判断身份证
function judgeIdCard(ID){
    // 判断是否是数字
    if(isNaN(ID)){
        return false;
    }
    if(!(/^\d{15}$|^\d{17}[0-9Xx]$/.test(ID))){
        return false;
    }
    return true;
}



// 判断纳税人识别号：数字和字母
function judgeTaxpayerCode(code){
    if(!(/^[0-9a-zA-Z]{0,}$/.test(code))){
        return false;
    }
    return true;
}
//判断账号是否为数字
function judgeNum(num) {
    if(isNaN(num)){
        return false;
    }
    return true;
}

// 判断手机号
function judgeMobile(tel_no){
    var RegExp = /^((0\d{2,3}-\d{7,8})|(1[345789]\d{9}))$/;
    if (RegExp.test(tel_no) == false) {
        alert("号码格式不正确或者位数不正确");
        return false;
    }
    return true;
}

// 判断手机号
function judgeMobile_onblur(ob){
    if(ob.value.length == 0){
        return;
    }
    var RegExp = /^((0\d{2,3}-\d{7,8})|(1[345789]\d{9}))$/;
    if (RegExp.test(ob.value) == false) {
        alert("号码格式不正确或者位数不正确");
        ob.value = '';
        return false;
    }
    return true;
}

function onlyNumber(ob) {
    if(isNaN(ob.value)){
        alert("只能为数字!");
        ob.value=ob.value.replace(/\D/g,'');
    }

}

function onlyChinese(ob) {
    var re=/[^\u4e00-\u9fa5]/;
    if(re.test(ob.value)) {
        alert("只能为中文！");
        ob.value=ob.value.replace(/[^\u4E00-\u9FA5]/g,'')
    }
}

function isAllChinese(ob){
    var patrn=/[\u4E00-\u9FA5]|[\uFE30-\uFFA0]/gi;
    if(!patrn.exec(ob.value)){
        alert("甲方名称至少有文字!");
    }
}

//验证邮箱
function validEmail(ob){
    if(ob.value.length == 0){
        return;
    }
    var reg = /^(\w)+(\.\w+)*@(\w)+((\.\w{2,3}){1,3})$/;
    if(!reg.exec(ob.value)){
        alert("邮箱格式不对！");
        ob.value = '';
        ob.focus();
        return false;
    }
    return true;
}

function toDate(date){
    var year = date.substring(0,4);
    var month = date.substring(5,7);
    var day = date.substring(8,10);
    return new Date(year+"-"+month+"-"+day);
}


//甲方名称自动填充
$("#first_party").keyup(function(){
    $this=$(this);
    $("#jf_name").val($this.val());
});
//法定代表人自动填充
$("#first_party_charge").keyup(function(){
    $this=$(this);
    $("#jf_fddbr").val($this.val());
});
//地址自动填充
$("#first_party_address").keyup(function(){
    $this=$(this);
    $("#jf_address").val($this.val());
});